trigger:
- main

pr:
  autoCancel: true
  branches:
    include:
      - main
      - dev/*

pool:
  vmImage: windows-latest

steps:
- task: PoliCheck@2
  inputs:
    targetType: 'F'
    targetArgument: '$(Build.SourcesDirectory)'

- task: ComponentGovernanceComponentDetection@0
  displayName: 'Component Detection'

- task: AntiMalware@4
  inputs:
    InputType: 'Basic'
    ScanType: 'CustomScan'
    FileDirPath: '$(Build.StagingDirectory)'
    TreatSignatureUpdateFailureAs: 'Warning'
    SignatureFreshness: 'UpToDate'
    TreatStaleSignatureAs: 'Error'

- task: CredScan@3
  inputs:
    scanFolder: '$(Build.SourcesDirectory)'

- task: TSAUpload@1
  inputs:
    tsaVersion: TsaV2
    codebase: NewOrUpdate
    codeBaseName: 'vc-ue-extensions'
    notificationAlias: 'cpp-apogee@microsoft.com'
    instanceUrlForTsaV2: DEVDIV
    projectNameDEVDIV: DevDiv
    areaPath: 'DevDiv\Cpp Developer Experience\Apogee\Unreal Engine integrations'
    iterationPath: DevDiv
